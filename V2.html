<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>حاسبة سعرات القط</title>
<style>
  :root{
    --bg:#0e1621; --panel:#131f2b; --ink:#ecf1f8; --muted:#a9b6c7; --accent1:#8a5cf6; --accent2:#44d2dc; --danger:#ff6b6b;
    --ok:#22c55e; --border:#254055;
  }
  html,body{margin:0;background:linear-gradient(180deg,#0b1420,#0d1a29);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .wrap{max-width:900px;margin-inline:auto;padding:20px}
  .topbar{display:flex;align-items:center;gap:10px;justify-content:space-between}
  h1{font-weight:800;letter-spacing:.5px;margin:8px 0 16px;font-size:clamp(22px,4vw,32px)}
  .lang{display:inline-flex;border-radius:999px;background:#0f1c2a;border:1px solid var(--border);overflow:hidden}
  .lang button{all:unset;padding:6px 14px;cursor:pointer;color:var(--muted);font-weight:700}
  .lang button.active{color:white;background:linear-gradient(90deg,var(--accent1),var(--accent2))}
  .card{background:radial-gradient(1200px 500px at 100% -80%,rgba(138,92,246,.15),transparent),radial-gradient(800px 300px at -20% 120%,rgba(68,210,220,.1),transparent),var(--panel);
        border:1px solid var(--border);border-radius:16px;padding:16px;margin-top:16px}
  .row{display:grid;grid-template-columns:1fr;gap:12px}
  @media (min-width:700px){.row{grid-template-columns:1fr 1fr}}
  label{font-size:.95rem;color:var(--muted);display:block;margin:4px 4px 6px}
  input[type="number"],select{width:100%;padding:14px 12px;border-radius:12px;background:#0f1a26;color:var(--ink);border:1px solid var(--border);font-size:1.05rem}
  .hidden{display:none !important}
  .checks{display:flex;gap:10px;flex-wrap:wrap}
  .chip{display:flex;align-items:center;gap:8px;padding:10px 12px;border-radius:12px;background:#0f1a26;border:1px dashed var(--border)}
  .chip input{width:20px;height:20px}
  .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
  .btn{all:unset;cursor:pointer;border-radius:14px;padding:12px 16px;font-weight:800}
  .btn.primary{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white}
  .btn.ghost{border:1px solid var(--border);background:#0f1a26;color:var(--ink)}
  .note{margin-top:8px;font-size:.9rem;color:#d1dae6}
  .error{background:#26151a;border:1px solid #7d2b37;color:#ffd7dc;padding:10px 12px;border-radius:12px}
  .results .item{display:flex;justify-content:space-between;align-items:center;border:1px dashed var(--border);border-radius:14px;padding:14px 12px;margin-top:10px}
  .kbd{font-family:ui-monospace,Menlo,Consolas,monospace;background:#0f1a26;border:1px solid var(--border);padding:2px 6px;border-radius:8px}
  footer{opacity:.8;text-align:center;padding:24px 8px}
</style>
</head>
<body>
<div class="wrap">
  <div class="topbar">
    <h1 id="title">حاسبة سعرات القط</h1>
    <div class="lang" role="tablist">
      <button id="btnAr" class="active" aria-selected="true">ع</button>
      <button id="btnEn">E</button>
    </div>
  </div>

  <div id="gate" class="card">
    <h3 id="sexGateTitle" style="margin-top:0;margin-bottom:8px">اختر الجنس للمتابعة</h3>
    <div class="row">
      <div>
        <label id="sexLabel">جنس القطة</label>
        <select id="sex">
          <option value="" selected>—</option>
          <option value="male">ذكر</option>
          <option value="female">أنثى</option>
        </select>
      </div>
    </div>
  </div>

  <div id="form" class="card hidden">
    <h2 id="inputsHeading" style="margin-top:0">المدخلات</h2>
    <div class="row">
      <div>
        <label id="wLabel">الوزن الحالي (كجم)</label>
        <input id="weight" type="number" min="0" step="0.001" placeholder="مثال: 3.2"/>
      </div>
      <div>
        <label id="ageLabel">الفئة العمرية/الحالة الأساسية</label>
        <select id="age">
          <option value="kitten">صغيرة (٢–٤ أشهر)</option>
          <option value="junior">متوسطة (٥–١٢ شهر)</option>
          <option value="adult">بالغة (أكبر من سنة)</option>
          <option value="neutered">معقمة</option>
        </select>
      </div>
    </div>

    <div id="kittenRow" class="row">
      <div>
        <label id="weekLabel">الأسبوع</label>
        <select id="kittenWeek"></select>
      </div>
    </div>

    <div id="juniorRow" class="row hidden">
      <div>
        <label id="monthLabel">الشهر</label>
        <select id="juniorMonth"></select>
      </div>
    </div>

    <div id="activityRow" class="row hidden">
      <div>
        <label id="actLabel">النشاط</label>
        <select id="activity">
          <option value="low">قليل</option>
          <option value="med">متوسط</option>
          <option value="high">عالي</option>
        </select>
      </div>
    </div>

    <div id="reproBlock" class="row hidden">
      <div class="checks">
        <label class="chip hidden" id="pregChip"><input type="checkbox" id="preg"/> <span id="pregTxt">حامل</span></label>
        <label class="chip hidden" id="lactChip"><input type="checkbox" id="lact"/> <span id="lactTxt">مرضعـة</span></label>
      </div>
    </div>

    <div id="pregRow" class="row hidden">
      <div>
        <label id="wpLabel">الوزن قبل الحمل (كجم)</label>
        <input id="wPrior" type="number" min="0" step="0.001" placeholder="مثال: 3.8"/>
      </div>
      <div>
        <label id="pWeekLabel">أسبوع الحمل</label>
        <select id="pregWeek">
          <option value="1-4">١–٤</option>
          <option value="5">٥</option>
          <option value="6">٦</option>
          <option value="7">٧</option>
          <option value="8">٨</option>
          <option value="9">٩</option>
        </select>
      </div>
    </div>

    <div id="lactRow" class="row hidden">
      <div>
        <label id="kCountLabel">عدد الصغار</label>
        <select id="kCount">
          <option value="2+">≥٢</option>
          <option value="3-4">٣–٤</option>
          <option value="5-6">٥–٦</option>
          <option value="7+">٧≤</option>
        </select>
      </div>
      <div>
        <label id="lWeekLabel">أسبوع الإرضاع</label>
        <select id="lactWeek"></select>
      </div>
    </div>

    <div class="actions">
      <button class="btn primary" id="calcBtn">احسب النتائج</button>
      <button class="btn ghost" id="resetBtn">إعادة ضبط</button>
    </div>
    <p id="err" class="error hidden"></p>
  </div>

  <div id="resultsCard" class="card hidden results">
    <h2 id="resHeading" style="margin-top:0">النتائج</h2>
    <div class="item"><div id="resCLabel">السعرات اليومية</div><div><span id="resC">0</span> kcal</div></div>
    <div class="item"><div id="resNLabel">عدد الوجبات</div><div id="resN">0</div></div>
    <div class="item"><div id="resFFLabel">الأكل الحر</div><div id="resFF">بدون أكل حر</div></div>
  </div>

  <footer>© ALBRAICHY 2025 — جميع الحقوق محفوظة</footer>
</div>

<script>
(function(){
  const el = id => document.getElementById(id);

  const i18n = {
    ar:{
      title:'حاسبة سعرات القط',
      gate:'اختر الجنس للمتابعة',
      sex:'جنس القطة',
      inputs:'المدخلات',
      weight:'الوزن الحالي (كجم)',
      age:'الفئة العمرية/الحالة الأساسية',
      kitten:'صغيرة (٢–٤ أشهر)',
      junior:'متوسطة (٥–١٢ شهر)',
      adult:'بالغة (أكبر من سنة)',
      neutered:'معقمة',
      week:'الأسبوع',
      month:'الشهر',
      activity:'النشاط',
      low:'قليل', med:'متوسط', high:'عالي',
      pregnant:'حامل', lactating:'مرضعـة',
      wprior:'الوزن قبل الحمل (كجم)',
      pweek:'أسبوع الحمل',
      kcount:'عدد الصغار',
      lweek:'أسبوع الإرضاع',
      calc:'احسب النتائج', reset:'إعادة ضبط',
      err_weight:'أدخل الوزن الحالي بشكل صحيح (أكبر من صفر).',
      err_wprior:"الوزن قبل الحمل مطلوب عند اختيار 'حامل'.",
      results:'النتائج', dc:'السعرات اليومية', meals:'عدد الوجبات', ff:'الأكل الحر',
      male:'ذكر', female:'أنثى', none:'—',
      free_yes: w=>`مع أكل حر — المطلوب تقريبًا ${w.toFixed(2)} غ`,
      free_no:'بدون أكل حر'
    },
    en:{
      title:'Cat Calorie Calculator',
      gate:'Select Sex to continue',
      sex:'Sex',
      inputs:'Inputs',
      weight:'Current Weight (kg)',
      age:'Age / Base Condition',
      kitten:'Kitten (2–4 mo)',
      junior:'Junior (5–12 mo)',
      adult:'Adult (>1 yr)',
      neutered:'Neutered',
      week:'Week',
      month:'Month',
      activity:'Activity',
      low:'Low', med:'Medium', high:'High',
      pregnant:'Pregnant', lactating:'Lactating',
      wprior:'Pre-pregnancy Weight (kg)',
      pweek:'Pregnancy Week',
      kcount:'Kitten Count',
      lweek:'Lactation Week',
      calc:'Calculate', reset:'Reset',
      err_weight:'Enter a valid current weight (>0).',
      err_wprior:"Pre-pregnancy weight is required when 'Pregnant' is selected.",
      results:'Results', dc:'Daily Calories', meals:'Meals per Day', ff:'Free-feeding',
      male:'Male', female:'Female', none:'—',
      free_yes: w=>`Free-feeding — approx. ${w.toFixed(2)} g`, free_no:'No free-feeding'
    }
  };

  let lang = 'ar';

  // Tables (from your spec/images)
  const A_small = {5:2.50,6:2.45,7:2.40,8:2.35,9:2.30,10:2.25,11:2.20,12:2.15,13:2.10,14:2.10,15:2.00,16:2.00};
  const smallFree = w => (w<=14); // free-food allowed up to week 14
  const A_junior = {5:1.95,6:1.90,7:1.85,8:1.80,9:1.75,10:1.50,11:1.50,12:1.50};
  const juniorFree = m => false;
  const A_adult = {low:0.90,med:1.00,high:1.10};
  const adultFree = act => (act==='high');
  const A_neut = {low:0.75,med:0.85,high:0.95};
  const neutFree = act => (act==='high');

  const P = {'1-4':1.00,'5':1.10,'6':1.20,'7':1.30,'8':1.40,'9':1.45};
  // Lactation multipliers L (approx table; can be adjusted to your exact data later)
  const L = {
    '2+': {1:1.6,2:1.8,3:2.0,4:2.0,5:1.8,6:1.6,7:1.3,8:1.16,9:1.13,10:1.0},
    '3-4': {1:1.8,2:2.2,3:2.5,4:3.0,5:2.7,6:2.4,7:1.9,8:1.5,9:1.25,10:1.0},
    '5-6': {1:2.0,2:2.5,3:2.8,4:3.0,5:2.6,6:2.3,7:1.7,8:1.4,9:1.2,10:1.0},
    '7+': {1:2.2,2:2.7,3:3.0,4:3.0,5:2.8,6:2.6,7:2.0,8:1.5,9:1.3,10:1.0}
  };

  // Populate selects
  const kittenWeek = el('kittenWeek');
  for(let w=5; w<=16; w++){ const o = document.createElement('option'); o.value=w; o.textContent=w; kittenWeek.appendChild(o); }
  const juniorMonth = el('juniorMonth');
  for(let m=5; m<=12; m++){ const o = document.createElement('option'); o.value=m; o.textContent=m; juniorMonth.appendChild(o); }
  const lactWeek = el('lactWeek');
  for(let w=1; w<=10; w++){ const o = document.createElement('option'); o.value=w; o.textContent=(lang==='ar'?'الأسبوع ':'Week ')+w; lactWeek.appendChild(o); }

  // Helpers
  const t = k => i18n[lang][k];
  function syncLang(){
    document.documentElement.dir = (lang==='ar'?'rtl':'ltr');
    el('title').textContent = t('title');
    el('sexGateTitle').textContent = t('gate');
    el('sexLabel').textContent = t('sex');
    el('inputsHeading').textContent = t('inputs');
    el('wLabel').textContent = t('weight');
    el('ageLabel').textContent = t('age');
    el('weekLabel').textContent = t('week');
    el('monthLabel').textContent = t('month');
    el('actLabel').textContent = t('activity');
    el('pregTxt').textContent = t('pregnant');
    el('lactTxt').textContent = t('lactating');
    el('wpLabel').textContent = t('wprior');
    el('pWeekLabel').textContent = t('pweek');
    el('kCountLabel').textContent = t('kcount');
    el('lWeekLabel').textContent = t('lweek');
    el('calcBtn').textContent = t('calc');
    el('resetBtn').textContent = t('reset');
    el('resHeading').textContent = t('results');
    el('resCLabel').textContent = t('dc');
    el('resNLabel').textContent = t('meals');
    el('resFFLabel').textContent = t('ff');

    // Age options
    const age = el('age');
    age.options[0].textContent = t('kitten');
    age.options[1].textContent = t('junior');
    age.options[2].textContent = t('adult');
    age.options[3].textContent = t('neutered');
    // Activity
    const act = el('activity');
    act.options[0].textContent = t('low'); act.options[1].textContent = t('med'); act.options[2].textContent = t('high');
    // Sex select options
    const sexSel = el('sex');
    sexSel.options[0].textContent = t('none');
    sexSel.options[1].textContent = t('male');
    sexSel.options[2].textContent = t('female');

    // Lact week labels refresh
    lactWeek.innerHTML='';
    for(let w=1; w<=10; w++){ const o = document.createElement('option'); o.value=w; o.textContent=(lang==='ar'?('الأسبوع '+w):('Week '+w)); lactWeek.appendChild(o); }
    // Junior month label numbers
    juniorMonth.querySelectorAll('option').forEach(opt=>{ opt.textContent = opt.value; });
    kittenWeek.querySelectorAll('option').forEach(opt=>{ opt.textContent = opt.value; });
  }

  function show(elm){ elm.classList.remove('hidden'); }
  function hide(elm){ elm.classList.add('hidden'); }

  function resetAll(){
    el('weight').value='';
    el('wPrior').value='';
    el('age').value='kitten';
    el('kittenWeek').value='5';
    el('juniorMonth').value='5';
    el('activity').value='low';
    el('preg').checked=false; el('lact').checked=false;
    hide(el('pregRow')); hide(el('lactRow'));
    show(el('kittenRow')); hide(el('juniorRow')); hide(el('activityRow'));
    hide(el('resultsCard'));
    hide(el('err')); el('err').textContent='';
  }

  function gateChanged(){
    const s = el('sex').value;
    if(!s){ hide(el('form')); hide(el('resultsCard')); return; }
    show(el('form'));
    // Reproductive block visible only for females (and age constraints inside)
    if(s==='female'){ show(el('reproBlock')); } else { hide(el('reproBlock')); hide(el('pregRow')); hide(el('lactRow')); el('preg').checked=false; el('lact').checked=false; }
    ageChanged();
  }

  function ageChanged(){
    const a = el('age').value;
    if(a==='kitten'){ show(el('kittenRow')); hide(el('juniorRow')); hide(el('activityRow')); }
    else if(a==='junior'){ hide(el('kittenRow')); show(el('juniorRow')); hide(el('activityRow')); }
    else { hide(el('kittenRow')); hide(el('juniorRow')); show(el('activityRow')); }

    // Pregnancy/Lactation availability
    const sex = el('sex').value;
    const pw = el('pregChip'), lw = el('lactChip');
    if(sex!=='female'){ hide(pw); hide(lw); return; }

    if(a==='kitten'){
      // Only week 16 can be pregnant; no lactation at all
      show(pw); hide(lw);
      // sync availability by week
      if(+el('kittenWeek').value === 16){ pw.classList.remove('hidden'); } else { pw.classList.remove('hidden'); el('preg').checked=false; hide(el('pregRow')); }
    }else if(a==='junior' || a==='adult' || a==='neutered'){
      // Adult or Junior: can be pregnant; lactation only when NOT kitten (allowed for junior/adult). Neutered shouldn't allow either.
      if(a==='neutered'){ hide(pw); hide(lw); el('preg').checked=false; el('lact').checked=false; hide(el('pregRow')); hide(el('lactRow')); }
      else { show(pw); show(lw); }
    }
  }

  function weekChanged(){
    if(el('age').value!=='kitten') return;
    // female only logic
    if(el('sex').value!=='female'){ return; }
    // Preg allowed only at week 16
    if(+el('kittenWeek').value===16){ show(el('pregChip')); } else { el('preg').checked=false; hide(el('pregRow')); show(el('pregChip')); }
    // Lactation never for kittens
    hide(el('lactChip')); el('lact').checked=false; hide(el('lactRow'));
  }

  function togglesChanged(){
    // Show rows depending on selections
    const isPreg = el('preg').checked;
    const isLact = el('lact').checked;
    if(isPreg){ show(el('pregRow')); } else { hide(el('pregRow')); }
    if(isLact){ show(el('lactRow')); } else { hide(el('lactRow')); }
  }

  function calc(){
    hide(el('err'));
    const w = parseFloat(el('weight').value);
    if(!(w>0)){ el('err').textContent=t('err_weight'); show(el('err')); hide(el('resultsCard')); return; }

    let A=1, allowFree=false;
    const age = el('age').value;

    if(age==='kitten'){
      const wk = +el('kittenWeek').value;
      A = A_small[wk] ?? 2.0;
      allowFree = smallFree(wk);
    }else if(age==='junior'){
      const m = +el('juniorMonth').value;
      A = A_junior[m] ?? 1.5;
      allowFree = juniorFree(m);
    }else if(age==='adult'){
      const act = el('activity').value;
      A = A_adult[act]; allowFree = adultFree(act);
    }else if(age==='neutered'){
      const act = el('activity').value;
      A = A_neut[act]; allowFree = neutFree(act);
    }

    let Pm = 1.0, Lm = 1.0;
    const sex = el('sex').value;
    if(sex==='female'){
      // Pregnancy
      if(el('preg').checked){
        const wp = parseFloat(el('wPrior').value);
        if(!(wp>0)){ el('err').textContent=t('err_wprior'); show(el('err')); hide(el('resultsCard')); return; }
        const wk = el('pregWeek').value;
        Pm = P[wk] ?? 1.0;
        // weight prior factor term per your original formula
        // Using 1 / ((W/Wprior)^0.67)
        Pm = Pm / Math.pow(w/wp,0.67);
      }
      // Lactation (never for kitten block since we hide it; safe here)
      if(el('lact').checked){
        const c = el('kCount').value;
        const lw = +el('lactWeek').value;
        Lm = (L[c] && L[c][lw]) ? L[c][lw] : 1.0;
        allowFree = true; // lactation table flags already imply free-food allowed
      }
    }

    // Calories
    const C = 100 * Math.pow(w,0.67) * A * Pm * Lm;

    // Meals computation
    // If free-feeding allowed: use N = floor(C/(40*w)) - 1 (from your earlier spec) and free grams = (C - N*40*w)/4
    // Else: N = ceil(C/(40*w))
    let N=0, freeStr=t('free_no');
    const perMealWet = 40*w; // assumed from your previous notes
    if(allowFree){
      N = Math.max(1, Math.floor(C/perMealWet) - 1);
      const delta = C - N*perMealWet;
      const grams = Math.max(0, delta/4); // dry grams ~ ΔC/4
      freeStr = i18n[lang].free_yes(grams);
    }else{
      N = Math.max(1, Math.ceil(C/perMealWet));
    }

    // Output
    show(el('resultsCard'));
    el('resC').textContent = C.toFixed(2);
    el('resN').textContent = String(N);
    el('resFF').textContent = freeStr;
  }

  // Listeners
  el('sex').addEventListener('change', gateChanged);
  el('age').addEventListener('change', ()=>{ ageChanged(); });
  el('kittenWeek').addEventListener('change', weekChanged);
  ['preg','lact'].forEach(id=> el(id).addEventListener('change', togglesChanged));

  el('calcBtn').addEventListener('click', calc);
  el('resetBtn').addEventListener('click', resetAll);

  el('btnAr').addEventListener('click', ()=>{ lang='ar'; el('btnAr').classList.add('active'); el('btnEn').classList.remove('active'); syncLang(); });
  el('btnEn').addEventListener('click', ()=>{ lang='en'; el('btnEn').classList.add('active'); el('btnAr').classList.remove('active'); syncLang(); });

  // init
  syncLang();
  resetAll();
})();
</script>
</body>
</html>
