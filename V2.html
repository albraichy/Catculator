<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>حاسبة سعرات القط</title>
<style>
  :root{
    --bg:#0b1220; --card:#111a2b; --ink:#e9f0ff; --muted:#b8c1d9;
    --accent1:#8a5cff; --accent2:#2fd4ff; --ok:#14e39a; --bad:#ff6b6b;
    --line:rgba(255,255,255,.08);
  }
  *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Noto Sans","Helvetica Neue",Arial}
  body{margin:0;background:linear-gradient(180deg,#0b1220,#0a1020 60%,#0b1220);color:var(--ink)}
  .wrap{max-width:880px;margin:auto;padding:24px}
  header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
  .brand{font-size:28px;font-weight:800;letter-spacing:.5px}
  .lang{display:flex;gap:6px;background:#0c1528;border:1px solid var(--line);padding:4px;border-radius:999px}
  .lang button{border:0;background:transparent;color:var(--muted);padding:8px 14px;border-radius:999px;cursor:pointer;font-weight:700}
  .lang button.active{color:#fff;background:linear-gradient(90deg,var(--accent1),var(--accent2))}
  .card{background:var(--card);border:1px solid var(--line);border-radius:18px;padding:18px;margin:14px 0}
  h2{margin:0 0 12px 0;font-size:22px}
  label{display:block;margin:10px 0 6px 0;color:var(--muted);font-size:14px}
  select, input[type="number"], input[type="text"]{
    width:100%;padding:14px 16px;border-radius:12px;border:1px solid var(--line);background:#0e1830;color:#fff;
    font-size:16px;
  }
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  .row{margin-top:8px}
  .hidden{display:none !important}
  .switches{display:flex;gap:12px;flex-wrap:wrap}
  .chip{display:flex;align-items:center;gap:10px;padding:12px 14px;border:1px dashed var(--line);border-radius:14px;min-width:160px}
  .chip input{width:22px;height:22px}
  .btns{display:flex;gap:12px;margin-top:8px}
  .btn{flex:0 0 auto;border:0;padding:14px 18px;border-radius:14px;cursor:pointer;font-weight:800}
  .primary{color:#fff;background:linear-gradient(90deg,var(--accent1),var(--accent2))}
  .ghost{background:#0e1830;color:#fff;border:1px solid var(--line)}
  .results .item{border:1px dashed var(--line);padding:14px;border-radius:14px;margin:10px 0;display:flex;justify-content:space-between;align-items:center}
  footer{opacity:.7;text-align:center;margin:30px 0 10px}
  .warn{color:#fff;background:#3c1a1a;border:1px solid #5e2a2a;padding:10px 12px;border-radius:10px;margin:10px 0}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand" data-i="title">حاسبة سعرات القط</div>
    <div class="lang">
      <button id="arBtn" class="active">ع</button>
      <button id="enBtn">E</button>
    </div>
  </header>

  <div class="card" id="sexCard">
    <h2 data-i="pickSexTitle">اختر الجنس للمتابعة</h2>
    <label data-i="sex">جنس القط</label>
    <select id="sex">
      <option value="" selected disabled>—</option>
      <option value="male" data-i="male">ذكر</option>
      <option value="female" data-i="female">أنثى</option>
    </select>
  </div>

  <div class="card hidden" id="inputsCard">
    <h2 data-i="inputs">المدخلات</h2>

    <label data-i="weightNow">الوزن الحالي (كجم)</label>
    <input id="wNow" type="number" min="0" step="0.001" placeholder="مثال: 2.3">

    <div class="grid">
      <div class="row">
        <label data-i="ageBase">الفئة العمرية/الحالة الأساسية</label>
        <select id="base">
          <option value="kitten" data-i="kitten">صغيرة (٢–٤ أشهر)</option>
          <option value="junior" data-i="junior">متوسطة (٥–١٢ شهر)</option>
          <option value="adult" data-i="adult">بالغة (أكبر من سنة)</option>
          <option value="spayed" data-i="spayed">معقمة</option>
        </select>
      </div>
      <div class="row" id="weekRow">
        <label id="weekLabel" data-i="week">الأسبوع</label>
        <select id="week"></select>
      </div>
    </div>

    <div class="row" id="activityRow">
      <label data-i="activity">النشاط</label>
      <select id="activity">
        <option value="low" data-i="low">نشاط قليل</option>
        <option value="med" data-i="med">نشاط متوسط</option>
        <option value="high" data-i="high">نشاط عالي</option>
      </select>
    </div>

    <div class="switches hidden" id="femaleSwitches">
      <label class="chip"><input type="checkbox" id="pregnant"><span data-i="pregnant">حامل</span></label>
      <label class="chip" id="lactChip"><input type="checkbox" id="lact"><span data-i="lact">مرضعة</span></label>
    </div>

    <div class="grid hidden" id="pregRow">
      <div>
        <label data-i="wPrior">الوزن قبل الحمل (كجم)</label>
        <input id="wPrior" type="number" min="0" step="0.001" placeholder="مثال: 3.8">
      </div>
      <div>
        <label data-i="pregWeek">أسابيع الحمل</label>
        <select id="pregWeek">
          <option value="1-4">1–4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
        </select>
      </div>
    </div>

    <div class="grid hidden" id="lactRow">
      <div>
        <label data-i="kittenCount">عدد الصغار</label>
        <select id="kCount">
          <option value="le2">≤2</option>
          <option value="3-4">3–4</option>
          <option value="5-6">5–6</option>
          <option value="ge7">≥7</option>
        </select>
      </div>
      <div>
        <label data-i="lactWeek">أسبوع الإرضاع</label>
        <select id="lactWeek">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
        </select>
      </div>
    </div>

    <div id="warn" class="warn hidden"></div>

    <div class="btns">
      <button class="btn primary" id="calcBtn" data-i="calc">احسب النتائج</button>
      <button class="btn ghost" id="resetBtn" data-i="reset">إعادة ضبط</button>
    </div>
  </div>

  <div class="card hidden" id="resultsCard">
    <h2 data-i="results">النتائج</h2>
    <div class="results">
      <div class="item"><div data-i="calories">السعرات اليومية</div><div id="calOut">0 kcal</div></div>
      <div class="item"><div data-i="meals">عدد الوجبات</div><div id="mealsOut">0</div></div>
      <div class="item"><div data-i="free">الأكل الحر</div><div id="freeOut">—</div></div>
    </div>
  </div>

  <footer>© Albraichy 2025 — All rights reserved</footer>
</div>

<script>
const i18n = {
  ar: {
    title:"حاسبة سعرات القط", pickSexTitle:"اختر الجنس للمتابعة", sex:"جنس القط",
    male:"ذكر", female:"أنثى", inputs:"المدخلات", weightNow:"الوزن الحالي (كجم)",
    ageBase:"الفئة العمرية/الحالة الأساسية", kitten:"صغيرة (٢–٤ أشهر)", junior:"متوسطة (٥–١٢ شهر)",
    adult:"بالغة (أكبر من سنة)", spayed:"معقمة", week:"الأسبوع", activity:"النشاط",
    low:"نشاط قليل", med:"نشاط متوسط", high:"نشاط عالي",
    pregnant:"حامل", lact:"مرضعة", wPrior:"الوزن قبل الحمل (كجم)",
    pregWeek:"أسابيع الحمل", kittenCount:"عدد الصغار", lactWeek:"أسبوع الإرضاع",
    calc:"احسب النتائج", reset:"إعادة ضبط", results:"النتائج",
    calories:"السعرات اليومية", meals:"عدد الوجبات", free:"الأكل الحر",
    warnPreg:"الوزن قبل الحمل مطلوب عند اختيار (حامل)."
  },
  en: {
    title:"Cat Calorie Calculator", pickSexTitle:"Select Sex to continue", sex:"Sex",
    male:"Male", female:"Female", inputs:"Inputs", weightNow:"Current Weight (kg)",
    ageBase:"Age / Base Condition", kitten:"Kitten (2–4 mo)", junior:"Junior (5–12 mo)",
    adult:"Adult (>1 yr)", spayed:"Spayed", week:"Week", activity:"Activity",
    low:"Low Activity", med:"Moderate Activity", high:"High Activity",
    pregnant:"Pregnant", lact:"Lactating", wPrior:"Pre-pregnancy Weight (kg)",
    pregWeek:"Pregnancy Weeks", kittenCount:"Kitten Count", lactWeek:"Lactation Week",
    calc:"Calculate", reset:"Reset", results:"Results",
    calories:"Daily Calories", meals:"Meals per Day", free:"Free-feeding",
    warnPreg:"Pre-pregnancy weight is required when 'Pregnant' is selected."
  }
};

const ui = {
  arBtn: document.getElementById('arBtn'),
  enBtn: document.getElementById('enBtn'),
  sex: document.getElementById('sex'),
  inputsCard: document.getElementById('inputsCard'),
  resultsCard: document.getElementById('resultsCard'),
  wNow: document.getElementById('wNow'),
  base: document.getElementById('base'),
  weekRow: document.getElementById('weekRow'),
  weekLabel: document.getElementById('weekLabel'),
  week: document.getElementById('week'),
  activityRow: document.getElementById('activityRow'),
  activity: document.getElementById('activity'),
  femaleSwitches: document.getElementById('femaleSwitches'),
  preg: document.getElementById('pregnant'),
  lact: document.getElementById('lact'),
  lactChip: document.getElementById('lactChip'),
  pregRow: document.getElementById('pregRow'),
  wPrior: document.getElementById('wPrior'),
  pregWeek: document.getElementById('pregWeek'),
  lactRow: document.getElementById('lactRow'),
  kCount: document.getElementById('kCount'),
  lactWeek: document.getElementById('lactWeek'),
  warn: document.getElementById('warn'),
  calcBtn: document.getElementById('calcBtn'),
  resetBtn: document.getElementById('resetBtn'),
  calOut: document.getElementById('calOut'),
  mealsOut: document.getElementById('mealsOut'),
  freeOut: document.getElementById('freeOut'),
};

let lang = 'ar';
function applyLang(){
  document.documentElement.lang = lang;
  document.documentElement.dir = lang==='ar'?'rtl':'ltr';
  ui.arBtn.classList.toggle('active', lang==='ar');
  ui.enBtn.classList.toggle('active', lang==='en');
  document.querySelectorAll('[data-i]').forEach(el=>{
    const k = el.getAttribute('data-i');
    el.textContent = i18n[lang][k];
  });
  // placeholders for number inputs
  ui.wNow.placeholder = lang==='ar'?'مثال: 2.3':'e.g., 2.3';
  ui.wPrior.placeholder = lang==='ar'?'مثال: 3.8':'e.g., 3.8';
}
ui.arBtn.onclick=()=>{lang='ar';applyLang()};
ui.enBtn.onclick=()=>{lang='en';applyLang()};

// Tables (A multipliers)
const A_kitten = {5:2.5,6:2.45,7:2.4,8:2.35,9:2.3,10:2.25,11:2.2,12:2.15,13:2.10,14:2.10,15:2.0,16:2.0};
const KIT_FF_ALLOW = {5:true,6:true,7:true,8:true,9:true,10:true,11:true,12:true,13:true,14:true,15:false,16:false}; // 15-16 no
const A_junior = {5:1.95,6:1.90,7:1.85,8:1.80,9:1.75,10:1.50,11:1.50,12:1.50};
const JUN_FF_ALLOW = {5:false,6:false,7:false,8:false,9:false,10:false,11:false,12:false};
const A_adult = {low:0.90, med:1.00, high:1.10};
const A_spayed = {low:0.75, med:0.85, high:0.95};
const ADULT_FF_ALLOW = {low:false, med:false, high:true};
const SPAY_FF_ALLOW = {low:false, med:false, high:true};

// Pregnancy P multipliers & free-food
const P_weeks = {"1-4":1.0,"5":1.10,"6":1.20,"7":1.30,"8":1.40,"9":1.45};
const P_FF = {"1-4":false, "5":false, "6":true, "7":true, "8":true, "9":true};

// Lactation L multipliers (simplified representative values)
const L_table = {
  "le2":  {1:1.6,2:1.8,3:2.0,4:2.0,5:1.8,6:1.6,7:1.3,8:1.0,9:1.0,10:1.0},
  "3-4":  {1:1.8,2:2.2,3:2.5,4:2.5,5:1.8,6:1.6,7:1.25,8:1.0,9:1.0,10:1.0},
  "5-6":  {1:2.0,2:2.5,3:2.8,4:3.0,5:1.8,6:1.5,7:1.2,8:1.0,9:1.0,10:1.0},
  "ge7":  {1:2.2,2:2.7,3:3.0,4:3.0,5:1.6,6:1.5,7:1.05,8:1.0,9:1.0,10:1.0},
};
function L_freeFoodAllowed(week, baseFF){
  if(week>=1 && week<=8) return true;
  if(week===9) return false;
  if(week===10) return baseFF; // inherit base rule at week 10
  return false;
}

// Populate week/month options
function fillWeeks(){
  ui.week.innerHTML='';
  const base = ui.base.value;
  const makeOpt=(v,lab)=>{
    const o=document.createElement('option');o.value=v;o.textContent=lab;ui.week.appendChild(o);
  };
  if(base==='kitten'){
    ui.weekLabel.textContent = i18n[lang].week;
    for(let w=5; w<=16; w++) makeOpt(String(w), lang==='ar'?`الأسبوع ${w}`:`Week ${w}`);
  } else if(base==='junior'){
    ui.weekLabel.textContent = lang==='ar'?'الشهر':'Month';
    for(let m=5;m<=12;m++) makeOpt(String(m), lang==='ar'?`الشهر ${m}`:`Month ${m}`);
  } else {
    ui.week.innerHTML='';
  }
}

function updateVisibility(){
  // hide all first
  ui.weekRow.classList.add('hidden');
  ui.activityRow.classList.add('hidden');
  ui.femaleSwitches.classList.add('hidden');
  ui.pregRow.classList.add('hidden');
  ui.lactRow.classList.add('hidden');
  ui.warn.classList.add('hidden');

  const sex = ui.sex.value;
  if(!sex){ ui.inputsCard.classList.add('hidden'); ui.resultsCard.classList.add('hidden'); return; }
  ui.inputsCard.classList.remove('hidden');

  const base = ui.base.value;
  // week/month selector for kitten/junior
  if(base==='kitten' || base==='junior'){
    ui.weekRow.classList.remove('hidden');
  }
  // activity only for adult/spayed
  if(base==='adult' || base==='spayed'){
    ui.activityRow.classList.remove('hidden');
  }

  // female-specific toggles
  if(sex==='female'){
    ui.femaleSwitches.classList.remove('hidden');
    // kitten special rules
    if(base==='kitten'){
      const w = parseInt(ui.week.value||'5',10);
      // at week 16: only pregnancy visible; lactation hidden
      if(w===16){
        ui.preg.disabled=false;
        ui.lact.checked=false;
        ui.lactChip.classList.add('hidden');
      } else {
        ui.lactChip.classList.add('hidden'); // lactation never for kittens
        // pregnancy allowed only week 16 (as per requirement)
        ui.preg.disabled = (w!==16);
        if(w!==16){ ui.preg.checked=false; }
      }
    } else {
      // non-kitten female: allow both toggles
      ui.preg.disabled=false;
      ui.lactChip.classList.remove('hidden');
    }
  }

  // show detail rows if toggled
  if(sex==='female' && ui.preg.checked){
    ui.pregRow.classList.remove('hidden');
  }
  if(sex==='female' && ui.lact.checked && base!=='kitten'){
    ui.lactRow.classList.remove('hidden');
  }
}

ui.sex.addEventListener('change', ()=>{updateVisibility()});
ui.base.addEventListener('change', ()=>{fillWeeks();updateVisibility()});
ui.week.addEventListener('change', updateVisibility);
ui.preg.addEventListener('change', updateVisibility);
ui.lact.addEventListener('change', updateVisibility);
ui.activity.addEventListener('change', updateVisibility);

// initial
fillWeeks(); applyLang(); updateVisibility();

function getAandFree(){
  const base = ui.base.value;
  let A=1, free=false;
  if(base==='kitten'){
    const w=parseInt(ui.week.value||'5',10);
    A = A_kitten[w]||2.5;
    free = KIT_FF_ALLOW[w];
  } else if(base==='junior'){
    const m=parseInt(ui.week.value||'5',10);
    A = A_junior[m]||1.95;
    free = JUN_FF_ALLOW[m];
  } else if(base==='adult'){
    const act=ui.activity.value;
    A=A_adult[act]; free = ADULT_FF_ALLOW[act];
  } else if(base==='spayed'){
    const act=ui.activity.value;
    A=A_spayed[act]; free = SPAY_FF_ALLOW[act];
  }
  return {A, free};
}

function compute(){
  const sex=ui.sex.value;
  const W=parseFloat(ui.wNow.value||'0');
  if(!(W>0)){ ui.warn.textContent = lang==='ar'?'أدخل الوزن الحالي بشكل صحيح (أكبر من صفر).':'Enter a valid current weight (>0).'; ui.warn.classList.remove('hidden'); return; }
  ui.warn.classList.add('hidden');

  // Base A and free rule
  const {A, free:baseFF} = getAandFree();
  let P=1, L=1, ff = baseFF;

  // Pregnancy
  if(sex==='female' && ui.preg.checked){
    const wPrior=parseFloat(ui.wPrior.value||'0');
    if(!(wPrior>0)){ ui.warn.textContent = i18n[lang].warnPreg; ui.warn.classList.remove('hidden'); return; }
    ui.warn.classList.add('hidden');
    const pw=ui.pregWeek.value;
    P=P_weeks[pw]||1.0;
    ff = ff || P_FF[pw]; // free if either base allows or pregnancy weeks allow
  }

  // Lactation
  if(sex==='female' && ui.lact.checked && ui.base.value!=='kitten'){
    const wk=parseInt(ui.lactWeek.value,10);
    const kc=ui.kCount.value;
    L = (L_table[kc] && L_table[kc][wk]) ? L_table[kc][wk] : 1.0;
    ff = L_freeFoodAllowed(wk, baseFF);
  }

  // Calories
  let C = 100 * Math.pow(W,0.67) * A * P * L;

  // Meals and free feeding
  const unitMeal = 40 * W;
  let meals=0, freeText='—';
  if(ff){
    // floor-based (with free food): N = floor(C/(40W)) - 1, but minimum 0
    meals = Math.max(0, Math.floor(C / unitMeal) - 1);
    const deltaC = Math.max(0, C - meals*unitMeal);
    const dryGrams = (deltaC/4).toFixed(2);
    freeText = (lang==='ar'?'مع أكل حر — المطلوب تقريباً ':'Free-feeding — ≈ ') + dryGrams + (lang==='ar'?' غ':'');
  }else{
    // no free food: ceil
    meals = Math.max(1, Math.ceil(C / unitMeal));
    freeText = lang==='ar'?'بدون أكل حر':'No free-feeding';
  }

  ui.calOut.textContent = C.toFixed(2)+' kcal';
  ui.mealsOut.textContent = String(meals);
  ui.freeOut.textContent = freeText;
  ui.resultsCard.classList.remove('hidden');
}

ui.calcBtn.addEventListener('click', compute);
ui.resetBtn.addEventListener('click', ()=>{ location.reload() });
</script>
</body>
</html>
