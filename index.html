<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø­Ø§Ø³Ø¨Ø© Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ù‚Ø· ğŸ¾ â€” V5</title>
<style>
  :root{--bg:#0b0e14;--card:#111623;--text:#eaf1ff;--muted:#98a2b3;--line:#1f2633;--danger:#ff6b6b;}
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0b0e14 0%,#0e1422 100%);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .hero{padding:40px 18px;border-bottom:1px solid #121826;background: radial-gradient(1200px 1200px at 90% -20%, rgba(106,227,255,.08), transparent 60%)}
  .container{max-width:980px;margin:0 auto}
  .title{font-weight:800;font-size:22px;margin-bottom:4px}
  .subtitle{font-size:12px;color:var(--muted)}
  .wrap{max-width:980px;margin:0 auto;padding:20px 18px 36px}
  .card{background:var(--card);padding:18px;border-radius:14px;border:1px solid var(--line);margin-bottom:14px}
  label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
  input, select, button{width:100%;padding:12px 10px;border-radius:10px;background:#0e1218;color:var(--text);border:1px solid #1d2432;font-size:15px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .error{font-size:13px;background:rgba(255,107,107,.12);border:1px solid var(--danger);color:#ffc1c1;padding:10px 12px;border-radius:10px;margin-top:8px;display:none}
  .result{font-size:16px;line-height:1.9}
  .k{font-weight:700}
  .hide{display:none !important}
  button{cursor:pointer;margin-top:14px}
  button:active{transform:translateY(1px)}
</style>
</head>
<body>

<section class="hero">
  <div class="container">
    <div class="title">Ø­Ø§Ø³Ø¨Ø© Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ù‚Ø· â€” V5</div>
    <div class="subtitle">ØªØ­Ø³ÙŠÙ†Ø§Øª Ù‚ÙˆÙŠØ© Ù„Ù„Ø²Ø±ØŒ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ØŒ ÙˆØ§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©.</div>
  </div>
</section>

<div class="wrap">
  <div class="card">
    <label>Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ø­Ø§Ù„ÙŠ W<sub>current</sub> (ÙƒØ¬Ù…)</label>
    <input id="wcur" type="text" inputmode="decimal" placeholder="Ù…Ø«Ø§Ù„: Ù¤Ù«Ù¢" value="Ù¤">

    <label style="margin-top:12px">Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¹Ù…Ø±ÙŠØ©/Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</label>
    <div class="row">
      <select id="baseCategory">
        <option value="kitten_small">ØµØºÙŠØ±Ø© (Ù¢â€“Ù¤ Ø£Ø´Ù‡Ø±)</option>
        <option value="kitten_mid">Ù…ØªÙˆØ³Ø·Ø© (Ù¥â€“Ù¡Ù¢ Ø´Ù‡Ø±)</option>
        <option value="adult" selected>Ø¨Ø§Ù„ØºØ© (Ø³Ù†Ø© <)</option>
        <option value="spayed">Ù…Ø¹Ù‚Ù…Ø©</option>
      </select>

      <div id="baseNumberWrap" class="hide">
        <input id="baseNumber" type="text" inputmode="numeric" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹/Ø§Ù„Ø£Ø´Ù‡Ø± Ø­Ø³Ø¨ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±">
      </div>

      <div id="adultActivityWrap">
        <select id="adultActivity">
          <option value="low">Ù‚Ù„ÙŠÙ„</option>
          <option value="med" selected>Ù…ØªÙˆØ³Ø·</option>
          <option value="high">Ø¹Ø§Ù„ÙŠ</option>
        </select>
      </div>
    </div>
    <div id="baseError" class="error"></div>

    <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:8px">
      <label style="display:flex;align-items:center;gap:8px"><input id="isPreg" type="checkbox" style="width:auto"> Ø­Ø§Ù…Ù„</label>
      <label style="display:flex;align-items:center;gap:8px"><input id="isLac" type="checkbox" style="width:auto"> Ù…Ø±Ø¶Ø¹Ø©</label>
    </div>

    <div id="pregBlock" class="row hide" style="margin-top:6px">
      <div>
        <label>Ø§Ù„ÙˆØ²Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø­Ù…Ù„ (ÙƒØ¬Ù…)</label>
        <input id="prePregW" type="text" inputmode="decimal" placeholder="Ù…Ø«Ø§Ù„: Ù£Ù«Ù¨">
      </div>
      <div>
        <label>Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ù…Ù„</label>
        <select id="pregWeek">
          <option value="1-4">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ù¡â€“Ù¤</option>
          <option value="5">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ù¥</option>
          <option value="6">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ù¦</option>
          <option value="7">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ù§</option>
          <option value="8">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ù¨</option>
          <option value="9">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ù©</option>
        </select>
      </div>
    </div>

    <div id="lacBlock" class="row hide" style="margin-top:6px">
      <div>
        <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø·</label>
        <select id="litter">
          <option value="le2">= Ø£Ùˆ â‰¤ Ù¢</option>
          <option value="3-4">Ù£â€“Ù¤</option>
          <option value="5-6">Ù¥â€“Ù¦</option>
          <option value="ge7">â‰¥ Ø£Ùˆ = Ù§</option>
        </select>
      </div>
      <div>
        <label>Ø£Ø³Ø§Ø¨ÙŠØ¹ Ø§Ù„Ø¥Ø±Ø¶Ø§Ø¹</label>
        <select id="lacWeek"></select>
      </div>
    </div>

    <div id="globalError" class="error"></div>
    <button id="calcBtn">Ø§Ø­Ø³Ø¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
  </div>

  <div class="card">
    <div class="result" id="resultBox">
      <div><span class="k">Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©:</span> 0 kcal</div>
      <div><span class="k">Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª:</span> 0</div>
      <div><span class="k">Ø§Ù„Ø£ÙƒÙ„ Ø§Ù„Ø­Ø±:</span> â€”</div>
    </div>
  </div>
</div>

<script>
// 1) Ø£Ø±Ù‚Ø§Ù… Ø¹Ø±Ø¨ÙŠØ© Ø¥Ù„Ù‰ Ù„Ø§ØªÙŠÙ†ÙŠØ©
function normalizeNumber(s){
  if(s==null) return '';
  const map = {'Ù ':'0','Ù¡':'1','Ù¢':'2','Ù£':'3','Ù¤':'4','Ù¥':'5','Ù¦':'6','Ù§':'7','Ù¨':'8','Ù©':'9','Ù«':'.',',':'.',' ':'','\u200f':''};
  return s.toString().split('').map(ch=>map[ch] ?? ch).join('');
}

// 2) Ø¬Ù‡Ù‘Ø² Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹
(function(){
  const lacWeek = document.getElementById('lacWeek');
  for(let i=1;i<=10;i++){ const o=document.createElement('option'); o.value=String(i); o.textContent='Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ '+i; lacWeek.appendChild(o); }
})();

// 3) Ø®Ø±Ø§Ø¦Ø· Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (ØºÙŠÙ‘Ø±Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø­Ø³Ø¨ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„)
const MAP = {
  kitten_small_weeks: (w)=>1.00,
  kitten_mid_months: (m)=>1.00,
  adult_activity: { low:1.00, med:1.00, high:1.00 },
  spayed_activity:{ low:1.00, med:1.00, high:1.00 },
  pregnancyP: { '1-4':1.00, '5':1.00, '6':1.00, '7':1.00, '8':1.00, '9':1.00 },
  lactationBaseP: { 'le2':1.00, '3-4':1.00, '5-6':1.00, 'ge7':1.00 },
  lactationWeekFactor: (wk)=>1.00,
  allowFreeFood: function(){ return false; },
  dryKcalPerGram: 4
};

// 4) Ø¹Ù†Ø§ØµØ±
const E = (id)=>document.getElementById(id);
const els = {
  W: E('wcur'),
  baseCat: E('baseCategory'),
  baseNum: E('baseNumber'),
  baseNumWrap: E('baseNumberWrap'),
  adultAct: E('adultActivity'),
  adultActWrap: E('adultActivityWrap'),
  baseErr: E('baseError'),
  isPreg: E('isPreg'),
  pregBlock: E('pregBlock'),
  prePregW: E('prePregW'),
  pregWeek: E('pregWeek'),
  isLac: E('isLac'),
  lacBlock: E('lacBlock'),
  litter: E('litter'),
  lacWeek: E('lacWeek'),
  globalError: E('globalError'),
  result: E('resultBox'),
  btn: E('calcBtn')
};

// 5) ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„
function toggleBlocks(){
  const cat = els.baseCat.value;
  const adultMode = (cat==='adult' || cat==='spayed');
  els.baseNumWrap.classList.toggle('hide', adultMode);
  els.adultActWrap.classList.toggle('hide', !adultMode);
  els.pregBlock.classList.toggle('hide', !els.isPreg.checked);
  els.lacBlock.classList.toggle('hide', !els.isLac.checked);
  if(adultMode){ els.baseNum.value=''; els.baseErr.style.display='none'; }
}

// 6) ØªØ­Ù‚Ù‚ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø¹Ù…Ø±
function validateBase(){
  const cat = els.baseCat.value;
  let ok = true, msg='';
  if(cat==='kitten_small'){
    const wk = parseInt(normalizeNumber(els.baseNum.value));
    if(isNaN(wk)){ ok=false; msg='Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹.'; }
    else if(wk<5 || wk>16){ ok=false; msg='Ø±Ù‚Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ØºÙŠØ± Ù…Ù†Ø§Ø³Ø¨ (Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ù¥â€“Ù¡Ù¦).'; }
  } else if(cat==='kitten_mid'){
    const mo = parseInt(normalizeNumber(els.baseNum.value));
    if(isNaN(mo)){ ok=false; msg='Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø£Ø´Ù‡Ø±.'; }
    else if(mo<5 || mo>12){ ok=false; msg='Ø±Ù‚Ù… Ø§Ù„Ø´Ù‡Ø± ØºÙŠØ± Ù…Ù†Ø§Ø³Ø¨ (Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ù¥â€“Ù¡Ù¢).'; }
  }
  els.baseErr.textContent = msg;
  els.baseErr.style.display = ok ? 'none' : 'block';
  return ok;
}

// 7) Ø­Ø³Ø¨Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ·
function computeOnce(){
  els.globalError.style.display='none';
  toggleBlocks();

  const W = parseFloat(normalizeNumber(els.W.value));
  if(!(W>0)){
    els.globalError.textContent='Ø£Ø¯Ø®Ù„ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ (Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±).';
    els.globalError.style.display='block';
    render(0,0,false,0);
    return;
  }

  const cat = els.baseCat.value;
  const baseOK = validateBase();
  if(!baseOK && (cat==='kitten_small' || cat==='kitten_mid')){
    els.globalError.textContent='ØªØ­Ù‚Ù‘Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹/Ø§Ù„Ø£Ø´Ù‡Ø± â€” Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚.';
    els.globalError.style.display='block';
    render(0,0,false,0);
    return;
  }

  // Ø§Ø´ØªÙ‚Ø§Ù‚ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª
  let A=1.0,P=1.0,L=1.0,Wprior=null;
  let weeks=null, months=null;
  if(cat==='kitten_small'){ weeks = parseInt(normalizeNumber(els.baseNum.value)); A = MAP.kitten_small_weeks(weeks); }
  else if(cat==='kitten_mid'){ months = parseInt(normalizeNumber(els.baseNum.value)); A = MAP.kitten_mid_months(months); }
  else if(cat==='adult'){ L = MAP.adult_activity[els.adultAct.value] ?? 1.0; }
  else if(cat==='spayed'){ L = MAP.spayed_activity[els.adultAct.value] ?? 1.0; }

  const isPreg = !!els.isPreg.checked;
  if(isPreg){
    P *= (MAP.pregnancyP[els.pregWeek.value] ?? 1.0);
    const pre = parseFloat(normalizeNumber(els.prePregW.value));
    if(pre>0) Wprior = pre;
  }
  const isLac = !!els.isLac.checked;
  if(isLac){
    P *= (MAP.lactationBaseP[els.litter.value] ?? 1.0) * MAP.lactationWeekFactor(parseInt(els.lacWeek.value||'1'));
  }

  const denom = (Wprior && Wprior>0) ? Math.pow(W/Wprior,0.67) : 1;
  const C = 100 * Math.pow(W,0.67) * A * (P/denom) * L;

  const N_noFree = Math.ceil(C/(40*W));
  let useFree=false, freeGrams=0, N=N_noFree;

  const allow = MAP.allowFreeFood({cat,weeks,months,adultActivity:els.adultAct.value,isPreg,pregWeek:els.pregWeek.value,isLac,litter:els.litter.value,lacWeek:parseInt(els.lacWeek.value||'1')});
  if(allow && N_noFree>=2){
    const N3 = Math.max(1, N_noFree-1);
    const dC = C - N3*(40*W);
    const kcalPerGram = MAP.dryKcalPerGram;
    freeGrams = (dC>0 && kcalPerGram>0)? dC/kcalPerGram : 0;
    if(dC>0){ useFree=true; N=N3; }
  }

  render(C,N,useFree,freeGrams);
}

// 8) Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
function render(C,N,useFree,freeGrams){
  const fmt = (x)=> (x? Number(x).toLocaleString('ar-EG',{maximumFractionDigits:2}) : '0');
  els.result.innerHTML =
    '<div><span class="k">Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©:</span> '+fmt(C)+' kcal</div>'+
    '<div><span class="k">Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª:</span> '+(N||0)+'</div>'+
    (useFree
      ? '<div><span class="k">Ø§Ù„Ø£ÙƒÙ„ Ø§Ù„Ø­Ø±:</span> Ù…Ø¹ Ø£ÙƒÙ„ Ø­Ø± â€” Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ '+fmt(freeGrams)+' Øº</div>'
      : '<div><span class="k">Ø§Ù„Ø£ÙƒÙ„ Ø§Ù„Ø­Ø±:</span> Ø¨Ø¯ÙˆÙ† Ø£ÙƒÙ„ Ø­Ø±</div>');
}

// 9) Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø¨Ù‚ÙˆØ© (onchange + onclick + addEventListener)
['change','input','click'].forEach(ev=>{
  els.baseCat.addEventListener(ev, toggleBlocks);
  els.isPreg.addEventListener(ev, toggleBlocks);
  els.isLac.addEventListener(ev, toggleBlocks);
});
els.btn.addEventListener('click', computeOnce);
// ÙƒÙ…Ø§Ù† setAttribute Ø¹Ø´Ø§Ù† Ø¨Ø¹Ø¶ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
els.btn.setAttribute('onclick','computeOnce()');

// init
toggleBlocks();
</script>
</body>
</html>
