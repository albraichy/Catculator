<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø­Ø§Ø³Ø¨Ø© Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ù‚Ø· ğŸ¾ â€” V8</title>
<style>
  :root{--bg:#0b0e14;--card:#111623;--text:#eaf1ff;--muted:#98a2b3;--line:#1f2633;--danger:#ff6b6b;}
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0b0e14 0%,#0e1422 100%);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .hero{padding:34px 18px;border-bottom:1px solid #121826;background: radial-gradient(1200px 1200px at 90% -20%, rgba(106,227,255,.08), transparent 60%)}
  .container{max-width:980px;margin:0 auto}
  .title{font-weight:800;font-size:22px;margin:0}
  .wrap{max-width:980px;margin:0 auto;padding:18px}
  .card{background:var(--card);padding:16px;border-radius:14px;border:1px solid var(--line);margin-bottom:14px}
  label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
  input, select, button{width:100%;padding:12px 10px;border-radius:10px;background:#0e1218;color:var(--text);border:1px solid #1d2432;font-size:15px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .error{font-size:13px;background:rgba(255,107,107,.12);border:1px solid var(--danger);color:#ffc1c1;padding:10px 12px;border-radius:10px;margin:8px 0;display:none}
  .result{font-size:16px;line-height:1.9}
  .k{font-weight:700}
  .hint{font-size:12px;color:var(--muted);margin-top:6px}
  .hide{display:none !important}
  button{cursor:pointer;margin-top:10px}
  button:active{transform:translateY(1px)}
</style>
</head>
<body>

<section class="hero">
  <div class="container">
    <h1 class="title">Ø­Ø§Ø³Ø¨Ø© Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ù‚Ø·</h1>
  </div>
</section>

<div class="wrap">
  <div class="card">
    <label>Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ø­Ø§Ù„ÙŠ (ÙƒØ¬Ù…)</label>
    <input id="wcur" type="text" inputmode="decimal" placeholder="Ù…Ø«Ø§Ù„: Ù Ù«Ù©">

    <label style="margin-top:10px">Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¹Ù…Ø±ÙŠØ©/Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</label>
    <div class="row">
      <select id="baseCategory" onchange="toggleBlocks()">
        <option value="kitten_small">ØµØºÙŠØ±Ø© (Ù¢â€“Ù¤ Ø£Ø´Ù‡Ø±)</option>
        <option value="kitten_mid">Ù…ØªÙˆØ³Ø·Ø© (Ù¥â€“Ù¡Ù¢ Ø´Ù‡Ø±)</option>
        <option value="adult">Ø¨Ø§Ù„ØºØ© (Ø£ÙƒØ¨Ø± Ù…Ù† Ø³Ù†Ø©)</option>
        <option value="spayed">Ù…Ø¹Ù‚Ù…Ø©</option>
      </select>

      <div id="baseNumberWrap">
        <input id="baseNumber" type="text" inputmode="numeric" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹ (Ù¥â€“Ù¡Ù¦)">
      </div>

      <div id="adultActivityWrap" class="hide">
        <select id="adultActivity">
          <option value="low">Ù†Ø´Ø§Ø· Ù‚Ù„ÙŠÙ„</option>
          <option value="med">Ù†Ø´Ø§Ø· Ù…ØªÙˆØ³Ø·</option>
          <option value="high">Ù†Ø´Ø§Ø· Ø¹Ø§Ù„ÙŠ</option>
        </select>
      </div>
    </div>

    <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:8px">
      <label style="display:flex;align-items:center;gap:8px"><input id="isPreg" type="checkbox" style="width:auto" onchange="toggleBlocks()"> Ø­Ø§Ù…Ù„</label>
      <label style="display:flex;align-items:center;gap:8px"><input id="isLac" type="checkbox" style="width:auto" onchange="toggleBlocks()"> Ù…Ø±Ø¶Ø¹Ø©</label>
    </div>

    <div id="pregBlock" class="row hide" style="margin-top:6px">
      <div>
        <label>Ø§Ù„ÙˆØ²Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø­Ù…Ù„ (ÙƒØ¬Ù…)</label>
        <input id="prePregW" type="text" inputmode="decimal" placeholder="Ù…Ø«Ø§Ù„: Ù£Ù«Ù¨">
      </div>
      <div>
        <label>Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ù…Ù„</label>
        <select id="pregWeek">
          <option value="1-4">Ù¡â€“Ù¤</option>
          <option value="5">Ù¥</option>
          <option value="6">Ù¦</option>
          <option value="7">Ù§</option>
          <option value="8">Ù¨</option>
          <option value="9">Ù©</option>
        </select>
      </div>
    </div>

    <div id="lacBlock" class="row hide" style="margin-top:6px">
      <div>
        <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø·</label>
        <select id="litter">
          <option value="le2">â‰¤Ù¢</option>
          <option value="3-4">Ù£â€“Ù¤</option>
          <option value="5-6">Ù¥â€“Ù¦</option>
          <option value="ge7">â‰¥Ù§</option>
        </select>
      </div>
      <div>
        <label>Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø¥Ø±Ø¶Ø§Ø¹</label>
        <select id="lacWeek"></select>
      </div>
    </div>

    <div id="errorAll" class="error"></div>

    <button id="calcBtn" onclick="computeOnce()">Ø§Ø­Ø³Ø¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
    <div class="hint">Ø§Ù„ØµÙŠØºØ©: 100Ã—W^0.67Ã—AÃ—(P/((W/Wprior)^0.67))Ã—L</div>
  </div>

  <div class="card">
    <div class="result" id="resultBox">
      <div><span class="k">Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©:</span> 0 kcal</div>
      <div><span class="k">Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª:</span> 0</div>
      <div><span class="k">Ø§Ù„Ø£ÙƒÙ„ Ø§Ù„Ø­Ø±:</span> â€”</div>
    </div>
  </div>
</div>

<script>
// ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù„Ù„Ø§ØªÙŠÙ†ÙŠØ©
function normalizeNumber(s){
  if(s==null) return '';
  const map = {'Ù ':'0','Ù¡':'1','Ù¢':'2','Ù£':'3','Ù¤':'4','Ù¥':'5','Ù¦':'6','Ù§':'7','Ù¨':'8','Ù©':'9','Ù«':'.',',':'.',' ':'','\u200f':''};
  return s.toString().split('').map(ch=>map[ch] ?? ch).join('');
}

// Ø¬Ù‡Ù‘Ø² Ø£Ø³Ø§Ø¨ÙŠØ¹ Ø§Ù„Ø¥Ø±Ø¶Ø§Ø¹ 0..10
(function(){
  const lacWeek = document.getElementById('lacWeek');
  for(let i=0;i<=10;i++){ const o=document.createElement('option'); o.value=String(i); o.textContent=(i===0?'Ø§ÙØªØ±Ø§Ø¶ÙŠ':'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ '+i); lacWeek.appendChild(o); }
})();

// == Ø¬Ø¯Ø§ÙˆÙ„ Ù…Ø¹Ø§Ù…Ù„Ø§ØªÙƒ Ù…Ù† Ø§Ù„ØµÙˆØ± ==

// A Ù„Ù„ØµØºÙŠØ±Ø© (Ø£Ø³Ø§Ø¨ÙŠØ¹)
const A_small = {5:2.50,6:2.45,7:2.40,8:2.35,9:2.30,10:2.25,11:2.20,12:2.15,13:2.10,14:2.10,15:2.00,16:2.00};

// A Ù„Ù„Ù…ØªÙˆØ³Ø·Ø© (Ø£Ø´Ù‡Ø± 5â†’12)
const A_mid   = {5:1.95,6:1.90,7:1.85,8:1.80,9:1.75,10:1.50,11:1.50,12:1.50};

// A Ù„Ù„Ø¨Ø§Ù„ØºØ©/Ø§Ù„Ù…Ø¹Ù‚Ù…Ø© (Ø­Ø³Ø¨ Ø§Ù„Ù†Ø´Ø§Ø·)
const A_adult   = { low:0.90, med:1.00, high:1.10 };
const A_spayed  = { low:0.75, med:0.85, high:0.95 };

// P Ù„Ù„Ø­Ù…Ù„
const P_preg = { '1-4':1.00, '5':1.10, '6':1.20, '7':1.30, '8':1.40, '9':1.45 };

// L Ù„Ù„Ø±Ø¶Ø§Ø¹Ø©: ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© (ÙŠÙ…ÙŠÙ†â†’ÙŠØ³Ø§Ø±) = â‰¤2, 3â€“4, 5â€“6, â‰¥7
const L_lac = {
  0:  { 'le2':1.0,  '3-4':1.0,  '5-6':1.0,  'ge7':1.0 },
  1:  { 'le2':1.6,  '3-4':1.8,  '5-6':2.0,  'ge7':2.2 },
  2:  { 'le2':1.8,  '3-4':2.2,  '5-6':2.5,  'ge7':2.7 },
  3:  { 'le2':2.0,  '3-4':2.5,  '5-6':2.8,  'ge7':3.0 },
  4:  { 'le2':2.0,  '3-4':2.5,  '5-6':3.0,  'ge7':3.0 },
  5:  { 'le2':1.8,  '3-4':2.3,  '5-6':2.6,  'ge7':2.7 },
  6:  { 'le2':1.6,  '3-4':2.1,  '5-6':2.3,  'ge7':2.4 },
  7:  { 'le2':1.3,  '3-4':1.7,  '5-6':1.9,  'ge7':2.0 },
  8:  { 'le2':1.2,  '3-4':1.4,  '5-6':1.5,  'ge7':1.6 },
  9:  { 'le2':1.05, '3-4':1.2,  '5-6':1.25, 'ge7':1.3 },
  10: { 'le2':1.0,  '3-4':1.0,  '5-6':1.0,  'ge7':1.0 }
};

// Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø£ÙƒÙ„ Ø§Ù„Ø­Ø± Ù…Ù† Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
function freeFoodAllowed(state){
  // ØµØºÙŠØ±Ø©
  if(state.cat==='kitten_small' && state.weeks) {
    if(state.weeks>=5 && state.weeks<=14) return true;
    if(state.weeks>=15) return false;
  }
  // Ù…ØªÙˆØ³Ø·Ø©
  if(state.cat==='kitten_mid') return false;
  // Ø¨Ø§Ù„ØºØ©/Ù…Ø¹Ù‚Ù…Ø©: Ù…Ø³Ù…ÙˆØ­ ÙÙ‚Ø· Ø¹Ù†Ø¯ Ù†Ø´Ø§Ø· Ø¹Ø§Ù„ÙŠ
  if(state.cat==='adult'  && state.adultActivity==='high') return true;
  if(state.cat==='spayed' && state.adultActivity==='high') return true;
  // Ø­Ù…Ù„: Ù…Ø³Ù…ÙˆØ­ Ù…Ù† Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 6 ÙÙ…Ø§ ÙÙˆÙ‚
  if(state.isPreg){
    const wk = state.pregWeek;
    if(wk==='6' || wk==='7' || wk==='8' || wk==='9') return true;
  }
  // Ø±Ø¶Ø§Ø¹Ø©: Ù…Ø³Ù…ÙˆØ­ Ù…Ù† 1 Ø¥Ù„Ù‰ 8
  if(state.isLac){
    const lw = parseInt(state.lacWeek||'0');
    if(lw>=1 && lw<=8) return true;
    if(lw>=9) return false;
  }
  return false;
}

// ÙƒØ«Ø§ÙØ© Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ù„Ù„Ø¯Ø±Ø§ÙŠ
const KCAL_PER_GRAM_DRY = 4;

// Ø§Ù„Ø¹Ù†Ø§ØµØ±
const els = {
  W: document.getElementById('wcur'),
  baseCat: document.getElementById('baseCategory'),
  baseNum: document.getElementById('baseNumber'),
  baseNumWrap: document.getElementById('baseNumberWrap'),
  adultAct: document.getElementById('adultActivity'),
  adultActWrap: document.getElementById('adultActivityWrap'),
  isPreg: document.getElementById('isPreg'),
  pregBlock: document.getElementById('pregBlock'),
  prePregW: document.getElementById('prePregW'),
  pregWeek: document.getElementById('pregWeek'),
  isLac: document.getElementById('isLac'),
  lacBlock: document.getElementById('lacBlock'),
  litter: document.getElementById('litter'),
  lacWeek: document.getElementById('lacWeek'),
  errorAll: document.getElementById('errorAll'),
  result: document.getElementById('resultBox')
};

function setBasePlaceholder(){
  const cat = els.baseCat.value;
  if(cat==='kitten_small'){
    els.baseNum.placeholder = 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹ (Ù¥â€“Ù¡Ù¦)';
  } else if(cat==='kitten_mid'){
    els.baseNum.placeholder = 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ø£Ø´Ù‡Ø± (Ù¥â€“Ù¡Ù¢)';
  } else {
    els.baseNum.placeholder = '';
  }
}

function toggleBlocks(){
  const cat = els.baseCat.value;
  const adultMode = (cat==='adult' || cat==='spayed');
  els.baseNumWrap.classList.toggle('hide', adultMode);
  els.adultActWrap.classList.toggle('hide', !adultMode);
  els.pregBlock.classList.toggle('hide', !els.isPreg.checked);
  els.lacBlock.classList.toggle('hide', !els.isLac.checked);
  if(adultMode){ els.baseNum.value=''; }
  setBasePlaceholder();
}

function validateAll(){
  let msgs = [];
  const W = parseFloat(normalizeNumber(els.W.value));
  if(!(W>0)) msgs.push('Ø£Ø¯Ø®Ù„ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ (Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±).');

  const cat = els.baseCat.value;
  if(cat==='kitten_small'){
    const wk = parseInt(normalizeNumber(els.baseNum.value));
    if(isNaN(wk) || wk<5 || wk>16) msgs.push('Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹ ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø¨ÙŠÙ† Ù¥ Ùˆ Ù¡Ù¦.');
  } else if(cat==='kitten_mid'){
    const mo = parseInt(normalizeNumber(els.baseNum.value));
    if(isNaN(mo) || mo<5 || mo>12) msgs.push('Ø§Ù„Ø£Ø´Ù‡Ø± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø¨ÙŠÙ† Ù¥ Ùˆ Ù¡Ù¢.');
  }
  els.errorAll.innerHTML = msgs.join('<br>');
  els.errorAll.style.display = msgs.length? 'block':'none';
  return {ok: msgs.length===0, W};
}

function computeOnce(){
  const v = validateAll();
  if(!v.ok){ render(0,0,false,0); return; }

  const W = v.W;
  const cat = els.baseCat.value;

  // Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª
  let A=1.0, P=1.0, L=1.0, Wprior=null, weeks=null, months=null;
  if(cat==='kitten_small'){ weeks = parseInt(normalizeNumber(els.baseNum.value)); A = A_small[weeks] ?? 1.0; }
  else if(cat==='kitten_mid'){ months = parseInt(normalizeNumber(els.baseNum.value)); A = A_mid[months] ?? 1.0; }
  else if(cat==='adult'){ A = A_adult[els.adultAct.value] ?? 1.0; }
  else if(cat==='spayed'){ A = A_spayed[els.adultAct.value] ?? 1.0; }

  if(els.isPreg.checked){
    const pw = els.pregWeek.value;
    P *= (P_preg[pw] ?? 1.0);
    const pre = parseFloat(normalizeNumber(els.prePregW.value));
    if(pre>0) Wprior = pre;
  }
  if(els.isLac.checked){
    const lw = parseInt(els.lacWeek.value||'0');
    const lt = els.litter.value;
    L *= (L_lac[lw] && L_lac[lw][lt]) ? L_lac[lw][lt] : 1.0;
  }

  const denom = (Wprior && Wprior>0) ? Math.pow(W/Wprior,0.67) : 1;
  const C = 100 * Math.pow(W,0.67) * A * (P/denom) * L;

  // Ù‡Ù„ Ù†Ø·Ø¨Ù‘Ù‚ Ø§Ù„Ø£ÙƒÙ„ Ø§Ù„Ø­Ø±ØŸ
  const ff = freeFoodAllowed({
    cat, weeks, months,
    adultActivity: els.adultAct.value,
    isPreg: els.isPreg.checked, pregWeek: els.pregWeek.value,
    isLac: els.isLac.checked, lacWeek: els.lacWeek.value
  });

  const baseMeal = 40*W;
  let N = Math.ceil(C / baseMeal);
  let useFree = false, freeGrams = 0;

  if(ff){
    N = Math.max(1, N - 1);
    const dC = C - N*baseMeal;
    freeGrams = dC > 0 ? dC / KCAL_PER_GRAM_DRY : 0;
    useFree = dC > 0;
  }

  render(C,N,useFree,freeGrams);
}

function render(C,N,useFree,freeGrams){
  const fmt = (x)=> (x? Number(x).toLocaleString('ar-EG',{maximumFractionDigits:2}) : '0');
  document.getElementById('resultBox').innerHTML =
    '<div><span class="k">Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©:</span> '+fmt(C)+' kcal</div>'+
    '<div><span class="k">Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª:</span> '+(N||0)+'</div>'+
    (useFree
      ? '<div><span class="k">Ø§Ù„Ø£ÙƒÙ„ Ø§Ù„Ø­Ø±:</span> Ù…Ø¹ Ø£ÙƒÙ„ Ø­Ø± â€” Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ '+fmt(freeGrams)+' Øº</div>'
      : '<div><span class="k">Ø§Ù„Ø£ÙƒÙ„ Ø§Ù„Ø­Ø±:</span> Ø¨Ø¯ÙˆÙ† Ø£ÙƒÙ„ Ø­Ø±</div>');
}

toggleBlocks();
</script>
</body>
</html>
